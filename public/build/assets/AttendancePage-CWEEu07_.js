import{r as s,j as t,a as $,b as L}from"./app-Dv9S9Y6z.js";import U from"./StudentList-Dn0b-1uA.js";import{A as C,U as z}from"./AttendanceStats-BhhRwVh5.js";import E from"./ScannerInput-Ci8Mz9zL.js";import F from"./FinalizeAttendance-DhrB6o4U.js";import{A as M}from"./arrow-left-XzW91b0b.js";import{S as Q}from"./search-DESFVEzC.js";import"./createLucideIcon-D9O30-1r.js";import"./circle-alert-DcnN304f.js";import"./users-CD7ITiNV.js";import"./x-B8Je2oco.js";function W({schedule:r}){const[m,x]=s.useState("list"),[u,g]=s.useState(""),[p,h]=s.useState(!1),[a,f]=s.useState(r.attendances),[c,b]=s.useState([]),[i,y]=s.useState([]),[R,S]=s.useState(!1);s.useEffect(()=>{a.length>0&&y(a.map(e=>e.student))},[a]),s.useEffect(()=>{const e=setInterval(()=>{i.length===c.length&&S(!0),b(a)},50);return()=>clearInterval(e)},[i,c]);const l=(e,n)=>{L.post(route("attendance.mark"),{student_id:e,status:n,schedule_id:r.id}),console.log("Marking attendance",e,n),console.log(a),f(a.map(o=>o.student_id===e?{...o,attendance_status:n}:o))},j=e=>{const n=i.find(o=>o.registration_number===e);n&&l(n.id,"present")},w=async e=>{e.forEach(n=>{l(Number(n),"excused")}),i.forEach(n=>{c.some(d=>d.student_id===n.id)||l(n.id,"absent")}),h(!1)},v=(e,n,o)=>{const d=new Date(e).toLocaleDateString("en-US",{weekday:"long"}),N=new Date(e).toLocaleDateString("en-US",{month:"long"}),A=new Date(e).toLocaleDateString("en-US",{day:"numeric"}),k=new Date(e).toLocaleDateString("en-US",{year:"numeric"}),D=new Date(`${e} ${n}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}),_=new Date(`${e} ${o}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric",hour12:!0});return`${d}, ${A} ${N} ${k}, ${D} - ${_}`};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("button",{onClick:()=>window.history.back(),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(M,{className:"w-5 h-5"})}),t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-semibold text-gray-900",children:[r.unit.name," - ",r.topic]}),t.jsxs("p",{className:"text-sm text-gray-600",children:[v(r.day,r.start_time,r.end_time)," â€¢ ",r.venue]})]})]}),t.jsx($,{href:route("dashboard"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Finalize Attendance"})]}),t.jsx(C,{total:a.length,present:a.filter(e=>e.attendance_status==="present").length,absent:a.filter(e=>e.attendance_status==="absent").length,excused:a.filter(e=>e.attendance_status==="excused").length}),t.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:[t.jsx("div",{className:"border-b border-gray-100",children:t.jsx("div",{className:"flex gap-4 p-4",children:t.jsxs("button",{onClick:()=>x("list"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors ${m==="list"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[t.jsx(z,{className:"w-5 h-5"}),"Student List"]})})}),t.jsx(E,{onScanComplete:j}),m==="list"&&t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"relative mb-4",children:[t.jsx(Q,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),t.jsx("input",{type:"text",placeholder:"Search students...",value:u,onChange:e=>g(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsx(U,{students:i,attendance:c,searchQuery:u,onMarkAttendance:l})]})]}),p&&t.jsx(F,{students:i,attendance:a,markedAttendance:c,onClose:()=>h(!1),onFinalize:w})]})}export{W as default};
