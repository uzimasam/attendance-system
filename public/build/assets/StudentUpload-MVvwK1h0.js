import{W as O,r as c,j as e}from"./app-DaOWxEH7.js";import{c as _}from"./createLucideIcon-DOaXj_ph.js";import{C as q}from"./circle-alert-Bcrj2Eca.js";/**
 * @license lucide-react v0.456.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=_("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function L({onSubmit:w,cohortId:S}){const{data:M,setData:D,post:C,processing:p,errors:T,reset:U}=O({data:[]}),[E,d]=c.useState(!1),[h,l]=c.useState(null),[a,g]=c.useState([]),o=c.useRef(null),m=t=>{t.preventDefault(),t.stopPropagation(),t.type==="dragenter"||t.type==="dragover"?d(!0):t.type==="dragleave"&&d(!1)},k=t=>{var s,r,n;return(s=t.regNo)!=null&&s.trim()?(r=t.name)!=null&&r.trim()?(n=t.email)!=null&&n.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email)?null:"Invalid email format":"Email is required":"Name is required":"Registration number is required"},f=async t=>{try{const r=(await t.text()).split(`
`),n=r[0].split(",").map(i=>i.trim().toLowerCase());if(!n.includes("regno")||!n.includes("name")||!n.includes("email")){l('CSV must include "regNo", "name", and "email" columns');return}const x=[],u=[];if(r.slice(1).filter(i=>i.trim()).forEach((i,V)=>{const F=i.split(","),y=n.reduce((I,j,A)=>{var N;return{...I,[j==="regno"?"regNo":j]:((N=F[A])==null?void 0:N.trim())||""}},{}),b=k(y);b?u.push(`Row ${V+2}: ${b}`):x.push({...y,id:crypto.randomUUID(),cohortId:S})}),u.length>0){l(`Validation errors:
${u.join(`
`)}`);return}g(x),D("data",x),l(null)}catch{l("Failed to process CSV file. Please check the file format.")}},P=async t=>{var r;t.preventDefault(),t.stopPropagation(),d(!1);const s=(r=t.dataTransfer.files)==null?void 0:r[0];(s==null?void 0:s.type)==="text/csv"?await f(s):l("Please upload a CSV file")},$=async t=>{var r;const s=(r=t.target.files)==null?void 0:r[0];s&&await f(s)},R=async t=>{if(t.preventDefault(),!a.length){l("No valid students to upload");return}try{await C(route("students.store"),{onSuccess:()=>{w(a),g([]),U(),o.current&&(o.current.value="")},onError:s=>{l(Object.values(s).join(`
`))}})}catch{l("Failed to upload students. Please try again.")}};return e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:e.jsx(v,{className:"w-6 h-6 text-blue-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Upload Students"})]}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center ${E?"border-blue-500 bg-blue-50":"border-gray-300"}`,onDragEnter:m,onDragLeave:m,onDragOver:m,onDrop:P,children:[e.jsx("input",{ref:o,type:"file",accept:".csv",onChange:$,className:"hidden"}),e.jsx(v,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Drag and drop your CSV file here, or"," ",e.jsx("button",{type:"button",onClick:()=>{var t;return(t=o.current)==null?void 0:t.click()},className:"text-blue-600 hover:text-blue-700",children:"browse"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"CSV should include columns: regNo, name, and email"})]}),h&&e.jsxs("div",{className:"flex items-start gap-2 text-red-600 bg-red-50 p-3 rounded-lg",children:[e.jsx(q,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"text-sm whitespace-pre-line",children:h})]}),a.length>0&&e.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Preview"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a.length," students"]})]})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Reg No"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Email"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[a.slice(0,5).map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:t.regNo}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:t.name}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900",children:t.email})]},t.id)),a.length>5&&e.jsx("tr",{children:e.jsxs("td",{colSpan:3,className:"px-4 py-2 text-sm text-gray-500 text-center",children:["And ",a.length-5," more students..."]})})]})]})})]}),a.length>0&&e.jsx("button",{type:"submit",disabled:p,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Uploading...":`Upload ${a.length} Students & Finish`})]})}const B=Object.freeze(Object.defineProperty({__proto__:null,default:L},Symbol.toStringTag,{value:"Module"}));export{L as S,v as U,B as a};
